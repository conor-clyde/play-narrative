<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Add Game</title>
</head>
<body>

<h1>Add Game</h1>

<div style="margin-bottom: 20px;">
    <input type="text" id="searchInput" placeholder="Search for games..." style="width: 200px;"/>
    <button onclick="searchGames()">Search</button>
    <div id="results" style="margin-top: 10px; display: none;"></div>
</div>

<form th:action="@{/games/add}" th:object="${game}" method="post">
    <div style="margin-bottom: 10px;">
        <label>Title: </label>
        <input type="text" th:field="*{title}" id="title" required/>
    </div>

    <div style="margin-bottom: 10px;">
        <label>RAWG ID: </label>
        <input type="text" th:field="*{rawgId}" id="rawgId" readonly style="background-color: #f5f5f5;"/>
    </div>

    <div style="margin-bottom: 10px;">
        <label>Owned: </label>
        <input type="radio" th:field="*{owned}" value="true"/> Yes
        <input type="radio" th:field="*{owned}" value="false" checked/> No
    </div>

    <div style="margin-bottom: 10px;">
        <label>Intent: </label>
        <select th:field="*{intent}">
            <option value="">Select intent</option>
            <option value="want-to-play">Want to play</option>
            <option value="want-to-buy">Want to buy</option>
            <option value="completed">Completed</option>
            <option value="playing">Currently playing</option>
            <option value="dropped">Dropped</option>
        </select>
    </div>

    <div style="margin-bottom: 15px;">
        <label>Platforms: </label>
        <input type="text" th:field="*{platforms}" placeholder="PC, PS5, Xbox..."/>
    </div>

    <button type="submit">Add to Library</button>
</form>

<a href="/games">Back to list</a>

<script>
function searchGames() {
    const query = document.getElementById('searchInput').value.trim();
    if (!query) {
        alert('Please enter a search term');
        return;
    }

    const resultsDiv = document.getElementById('results');
    resultsDiv.innerHTML = 'Searching...';
    resultsDiv.style.display = 'block';

    fetch(`/api/games/search?query=${encodeURIComponent(query)}`)
        .then(response => response.json())
        .then(games => {
            displayResults(games);
        })
        .catch(error => {
            console.error('Search failed:', error);
            resultsDiv.innerHTML = 'Search failed.';
        });
}

function displayResults(games) {
    const resultsDiv = document.getElementById('results');

    if (games.length === 0) {
        resultsDiv.innerHTML = 'No games found.';
        return;
    }

    let html = '<div style="border: 1px solid #ccc; max-height: 200px; overflow-y: auto;">';
    games.forEach(game => {
        html += `<div onclick="selectGame('${game.id}', '${game.name.replace(/'/g, "\\'")}')" style="padding: 8px; cursor: pointer; border-bottom: 1px solid #eee;">${game.name}</div>`;
    });
    html += '</div>';

    resultsDiv.innerHTML = html;
}

function selectGame(id, name) {
    document.getElementById('title').value = name;
    document.getElementById('rawgId').value = id;
}

document.getElementById('searchInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        searchGames();
    }
});
</script>

</body>
</html>